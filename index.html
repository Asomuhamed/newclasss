<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 9 Learning Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #003C71;
            --secondary: #002447;
            --accent: #E4A93C;
            --light: #EFECE3;
            --soft-blue: #8FA8C5;
            --dark: #212529;
            --success: #4bb543;
            --warning: #E4A93C;
            --danger: #dc3545;
            --gray: #6c757d;
            --sidebar-width: 250px;
            --header-height: 70px;
            --transition: all 0.3s ease;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
            --shadow-xl: 0 12px 40px rgba(0, 0, 0, 0.2);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            overflow-x: hidden;
        }

        /* Toast Notification System */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            max-width: 400px;
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
            border-left: 4px solid;
            position: relative;
            overflow: hidden;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(400px);
            }
        }

        .toast::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: currentColor;
            animation: toastProgress 3s linear;
        }

        @keyframes toastProgress {
            from { width: 100%; }
            to { width: 0; }
        }

        .toast.success {
            border-left-color: var(--success);
            color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
            color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
            color: var(--warning);
        }

        .toast.info {
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }

        .toast-message {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray);
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .toast-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--dark);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 60, 113, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(2px);
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
        }

        .loading-text {
            margin-top: 15px;
            color: var(--primary);
            font-weight: 600;
        }

        .btn-loading {
            position: relative;
            color: transparent !important;
            pointer-events: none;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Login Page Styles */
        .login-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--soft-blue) 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 50px 40px;
            width: 100%;
            max-width: 450px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent), #F5C84D);
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            font-weight: bold;
            color: white;
            box-shadow: 0 8px 20px rgba(228, 169, 60, 0.4);
            margin-bottom: 15px;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .login-subtitle {
            color: var(--gray);
            font-size: 1rem;
        }

        .login-form {
            margin-top: 30px;
        }

        .login-form-group {
            margin-bottom: 25px;
        }

        .login-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
            font-size: 1rem;
        }

        .login-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--soft-blue);
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .login-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(228, 169, 60, 0.15);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--accent), #F5C84D);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 6px 20px rgba(228, 169, 60, 0.4);
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(228, 169, 60, 0.5);
        }

        .login-error {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border: 1px solid var(--danger);
            text-align: center;
        }

        /* Language Selector Styles */
        .language-selector {
            position: relative;
            margin-right: 15px;
        }

        .language-btn {
            background: transparent;
            border: 2px solid var(--soft-blue);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .language-btn:hover {
            border-color: var(--accent);
            background-color: rgba(228, 169, 60, 0.1);
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 10px 0;
            min-width: 150px;
            z-index: 100;
            display: none;
        }

        .language-dropdown.active {
            display: block;
        }

        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-option:hover {
            background-color: var(--light);
        }

        .language-option.active {
            background-color: rgba(0, 60, 113, 0.1);
            color: var(--primary);
            font-weight: 600;
        }

        /* Main App Container */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        .app-container.active {
            display: flex;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            color: white;
            min-height: 100vh;
            position: fixed;
            transition: var(--transition);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent), #F5C84D);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 10px rgba(228, 169, 60, 0.3);
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
        }

        .sidebar-subtitle {
            font-size: 0.85rem;
            color: var(--soft-blue);
            margin-top: 5px;
        }

        .sidebar-menu {
            padding: 20px 0;
            flex: 1;
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .menu-item:hover {
            background-color: rgba(228, 169, 60, 0.15);
            border-left: 4px solid var(--accent);
        }

        .menu-item.active {
            background-color: rgba(228, 169, 60, 0.2);
            border-left: 4px solid var(--accent);
        }

        .menu-item i {
            font-size: 1.2rem;
            width: 25px;
            color: var(--soft-blue);
        }

        .menu-item.active i,
        .menu-item:hover i {
            color: var(--accent);
        }

        .logout-btn {
            margin: 20px;
            padding: 12px;
            background: rgba(220, 53, 69, 0.2);
            color: white;
            border: 2px solid rgba(220, 53, 69, 0.5);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: var(--danger);
            border-color: var(--danger);
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            height: var(--header-height);
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 99;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--soft-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .content {
            padding: 30px;
            flex: 1;
        }

        /* Page Transitions */
        .page-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Card Container Styles */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 0;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border-top: 4px solid var(--primary);
            overflow: hidden;
            position: relative;
            height: 180px;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 10px 20px rgba(228, 169, 60, 0.2);
            border-top: 4px solid var(--accent);
        }

        .card-icon {
            width: 100%;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            transition: transform 0.3s ease;
        }

        .card:hover .card-icon {
            transform: scale(1.05);
        }

        .card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            padding: 15px;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            margin: 0;
        }

        /* Subject Detail View */
        .subject-detail {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .back-btn {
            background: var(--soft-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            transition: var(--transition);
        }

        .back-btn:hover {
            background: var(--primary);
        }

        .detail-header {
            border-bottom: 3px solid var(--accent);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .detail-title {
            font-size: 2rem;
            color: var(--primary);
            font-weight: 700;
        }

        /* User Manager Styles */
        .user-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-manager-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
        }

        .add-user-btn {
            background: linear-gradient(135deg, var(--accent), #F5C84D);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(228, 169, 60, 0.3);
        }

        .add-user-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(228, 169, 60, 0.4);
        }

        .user-table-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow-x: auto;
        }

        .user-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .user-table th {
            background: linear-gradient(135deg, var(--primary), var(--soft-blue));
            color: white;
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e9ecef;
        }

        .user-table td {
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .user-table tr:last-child td {
            border-bottom: none;
        }

        .user-table tbody tr:hover {
            background-color: var(--light);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .edit-btn, .delete-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .edit-btn {
            background-color: rgba(228, 169, 60, 0.2);
            color: #B8842A;
        }

        .edit-btn:hover {
            background-color: var(--accent);
            color: white;
        }

        .delete-btn {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .delete-btn:hover {
            background-color: #dc3545;
            color: white;
        }

        /* Content Management Styles */
        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--accent);
        }

        .section-subtitle {
            font-size: 1rem;
            color: var(--gray);
            margin-bottom: 30px;
        }

        .content-section {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 30px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--soft-blue);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(228, 169, 60, 0.2);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--primary), var(--soft-blue));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(0, 60, 113, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 60, 113, 0.4);
        }

        /* Quiz Management Styles */
        .quiz-section {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 30px;
        }

        .quiz-form {
            margin-top: 20px;
        }

        .question-container {
            background-color: var(--light);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-number {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .remove-question {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .option-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .option-input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid var(--soft-blue);
            border-radius: 6px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .option-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .correct-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .correct-checkbox {
            width: 18px;
            height: 18px;
        }

        .add-question-btn {
            background: var(--soft-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            transition: var(--transition);
        }

        .add-question-btn:hover {
            background: var(--primary);
        }

        /* Take Quiz Button */
        .take-quiz-btn {
            background: linear-gradient(135deg, var(--primary), var(--soft-blue));
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .take-quiz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 60, 113, 0.3);
        }

        /* Quiz Modal Styles */
        .quiz-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 60, 113, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .quiz-modal-content {
            background-color: white;
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease;
        }

        .quiz-modal-header {
            padding: 25px 30px;
            border-bottom: 3px solid var(--accent);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .quiz-modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .quiz-modal-subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .quiz-modal-body {
            padding: 30px;
        }

        .quiz-progress {
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--light);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--accent), #F5C84D);
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: var(--gray);
            font-weight: 600;
        }

        .question-container-modal {
            margin-bottom: 30px;
        }

        .question-text-modal {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-item {
            padding: 15px 20px;
            border: 2px solid var(--soft-blue);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option-item:hover {
            border-color: var(--accent);
            background-color: rgba(228, 169, 60, 0.05);
        }

        .option-item.selected {
            border-color: var(--accent);
            background-color: rgba(228, 169, 60, 0.1);
        }

        .option-letter {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--soft-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            transition: var(--transition);
        }

        .option-item.selected .option-letter {
            background: var(--accent);
        }

        .option-text {
            flex: 1;
            font-size: 1.1rem;
        }

        .quiz-modal-footer {
            padding: 20px 30px;
            border-top: 2px solid var(--soft-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quiz-nav-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prev-btn {
            background: var(--light);
            color: var(--gray);
            border: 2px solid var(--soft-blue);
        }

        .prev-btn:hover:not(:disabled) {
            background: var(--soft-blue);
            color: white;
        }

        .next-btn, .submit-btn {
            background: linear-gradient(135deg, var(--accent), #F5C84D);
            color: white;
        }

        .next-btn:hover, .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(228, 169, 60, 0.4);
        }

        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Results Modal */
        .results-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 60, 113, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .results-content {
            background-color: white;
            border-radius: 15px;
            width: 100%;
            max-width: 600px;
            text-align: center;
            padding: 40px 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease;
        }

        .results-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--success), #5cb85c);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            color: white;
        }

        .results-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .results-score {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent);
            margin: 20px 0;
        }

        .results-details {
            margin: 25px 0;
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
        }

        .result-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--soft-blue);
        }

        .result-item.correct {
            border-left-color: var(--success);
            background-color: rgba(75, 181, 67, 0.1);
        }

        .result-item.incorrect {
            border-left-color: var(--danger);
            background-color: rgba(220, 53, 69, 0.1);
        }

        .question-result {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .answer-result {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .correct-answer {
            color: var(--success);
            font-weight: 600;
        }

        .close-results-btn {
            background: linear-gradient(135deg, var(--primary), var(--soft-blue));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 20px;
        }

        .close-results-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 60, 113, 0.4);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 60, 113, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 2px solid var(--soft-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .close-btn:hover {
            color: var(--accent);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 2px solid var(--soft-blue);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .cancel-btn, .save-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .cancel-btn {
            background-color: var(--light);
            color: var(--gray);
            border: 2px solid var(--soft-blue);
        }

        .cancel-btn:hover {
            background-color: var(--soft-blue);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, var(--accent), #F5C84D);
            color: white;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(228, 169, 60, 0.4);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .mobile-menu-toggle:hover {
            background: var(--accent);
        }

        /* New styles for unit/lesson structure */
        .unit-container {
            margin-bottom: 30px;
        }

        .unit-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .unit-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .unit-toggle {
            transition: var(--transition);
        }

        .unit-toggle.expanded {
            transform: rotate(180deg);
        }

        .lessons-container {
            display: none;
            padding-left: 20px;
        }

        .lesson-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lesson-title {
            font-weight: 600;
            color: var(--primary);
        }

        .lesson-actions {
            display: flex;
            gap: 10px;
        }

        .start-quiz-btn {
            background: linear-gradient(135deg, var(--accent), #F5C84D);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .start-quiz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(228, 169, 60, 0.3);
        }

        /* Question upload form styles */
        .question-upload-form {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 30px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* Results modal enhancements */
        .result-comparison {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .user-answer, .correct-answer {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .user-answer {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        .user-answer.correct {
            background: rgba(75, 181, 67, 0.1);
            border: 1px solid rgba(75, 181, 67, 0.3);
        }

        .correct-answer {
            background: rgba(75, 181, 67, 0.1);
            border: 1px solid rgba(75, 181, 67, 0.3);
        }

        /* Role-based visibility */
        .admin-only {
            display: none;
        }

        .user-admin .admin-only {
            display: block;
        }

        .user-admin .admin-only-inline {
            display: inline-block;
        }

        /* User info display */
        .user-info-display {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
            font-size: 0.9rem;
            color: var(--dark);
        }

        .user-info-display strong {
            color: var(--primary);
        }

        /* Question Management Styles */
        .question-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .question-manager-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
        }

        .question-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .question-table-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow-x: auto;
            margin-top: 20px;
        }

        .question-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .question-table th {
            background: linear-gradient(135deg, var(--primary), var(--soft-blue));
            color: white;
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e9ecef;
        }

        .question-table td {
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .question-table tr:last-child td {
            border-bottom: none;
        }

        .question-table tbody tr:hover {
            background-color: var(--light);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .question-options {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .correct-option {
            color: var(--success);
            font-weight: 600;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            color: var(--soft-blue);
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .empty-state-message {
            font-size: 1rem;
            margin-bottom: 25px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-state-action {
            margin-top: 20px;
        }

        /* Unit and Lesson Management Styles */
        .unit-list {
            margin-top: 30px;
        }

        .unit-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--accent);
        }

        .unit-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .unit-item-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .unit-item-description {
            color: var(--gray);
            margin-bottom: 15px;
        }

        .lesson-list {
            margin-left: 20px;
        }

        .lesson-item {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lesson-item-title {
            font-weight: 600;
            color: var(--primary);
        }

        .lesson-item-description {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Edit Question Modal Styles */
        .edit-question-modal {
            max-width: 700px;
        }

        .edit-question-modal .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .login-box {
                padding: 40px 30px;
            }

            .sidebar {
                transform: translateX(-100%);
                z-index: 1000;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .sidebar-header h2,
            .sidebar-subtitle,
            .menu-item span,
            .logout-btn span {
                display: none;
            }

            .logo-container {
                flex-direction: column;
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .menu-item {
                justify-content: center;
            }

            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .card-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .header {
                padding: 0 15px;
            }

            .content {
                padding: 20px;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .user-profile span {
                display: none;
            }

            .user-manager-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .add-user-btn {
                width: 100%;
                justify-content: center;
            }

            .quiz-modal-content {
                margin: 10px;
                max-height: 95vh;
            }

            .quiz-modal-body {
                padding: 20px;
            }

            .quiz-modal-footer {
                flex-direction: column;
                gap: 10px;
            }

            .quiz-nav-btn {
                width: 100%;
                justify-content: center;
            }

            .option-item {
                padding: 12px 15px;
            }

            .option-text {
                font-size: 1rem;
            }

            .question-filter {
                flex-direction: column;
            }

            .filter-group {
                min-width: 100%;
            }

            .form-row {
                flex-direction: column;
            }

            .unit-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .lesson-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .lesson-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        @media (max-width: 576px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .card-container {
                grid-template-columns: 1fr;
            }

            .header-left h1 {
                font-size: 1.3rem;
            }

            .user-profile span {
                display: none;
            }

            .content-section, .quiz-section {
                padding: 20px;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .quiz-actions {
                width: 100%;
                justify-content: space-between;
            }

            .action-btn {
                flex: 1;
                justify-content: center;
            }

            .question-container {
                padding: 15px;
            }

            .option-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .correct-option {
                align-self: flex-end;
            }

            .results-content {
                padding: 30px 20px;
                margin: 10px;
            }

            .results-score {
                font-size: 2.5rem;
            }

            .modal-content {
                margin: 10px;
            }

            .modal-body {
                padding: 20px;
            }

            .modal-footer {
                flex-direction: column;
                gap: 10px;
            }

            .cancel-btn, .save-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
        </div>
    </div>

    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="login-logo">
                <div class="login-logo-icon">9</div>
                <div class="login-title" data-translate="app_title">CLASS 9</div>
                <div class="login-subtitle" data-translate="login_subtitle">Learning Platform</div>
            </div>

            <div class="login-error" id="loginError" data-translate="login_error">
                Invalid username or password!
            </div>

            <form class="login-form" id="loginForm">
                <div class="login-form-group">
                    <label class="login-label" data-translate="username">Username</label>
                    <input type="text" class="login-input" id="loginUsername" placeholder="Enter your username" required>
                </div>

                <div class="login-form-group">
                    <label class="login-label" data-translate="password">Password</label>
                    <input type="password" class="login-input" id="loginPassword" placeholder="Enter your password" required>
                </div>

                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> <span data-translate="login">Login</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo">9</div>
                    <h2 data-translate="app_title">CLASS</h2>
                </div>
                <div class="sidebar-subtitle" data-translate="admin_panel">Learning Platform</div>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span data-translate="dashboard">Dashboard</span>
                </div>
                <div class="menu-item admin-only" data-page="user-manager">
                    <i class="fas fa-users"></i>
                    <span data-translate="user_manager">User Manager</span>
                </div>
                <div class="menu-item admin-only" data-page="questions-uploading">
                    <i class="fas fa-file-upload"></i>
                    <span data-translate="questions_uploading">Questions Uploading</span>
                </div>
                <div class="menu-item admin-only" data-page="question-management">
                    <i class="fas fa-question-circle"></i>
                    <span data-translate="question_management">Question Management</span>
                </div>
                <div class="menu-item admin-only" data-page="unit-lesson-management">
                    <i class="fas fa-book"></i>
                    <span data-translate="unit_lesson_management">Unit and Lesson Management</span>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span data-translate="logout">Logout</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="pageTitle" data-translate="dashboard">Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="language-selector">
                        <button class="language-btn" id="languageBtn">
                            <i class="fas fa-globe"></i>
                            <span id="currentLanguage">English</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="language-dropdown" id="languageDropdown">
                            <div class="language-option active" data-lang="en">
                                <span>English</span>
                            </div>
                            <div class="language-option" data-lang="ku">
                                <span>Kurd</span>
                            </div>
                            <div class="language-option" data-lang="ar">
                                <span></span>
                            </div>
                        </div>
                    </div>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">AD</div>
                        <span id="currentUser">Admin User</span>
                    </div>
                </div>
            </div>

            <!-- Content Sections -->
            <div class="content">
                <!-- Dashboard Section -->
                <div id="dashboard" class="page-section active">
                    <div class="user-info-display" id="dashboardUserInfo">
                        <!-- User info will be dynamically loaded here -->
                    </div>
                    <h2 style="margin-bottom: 20px; color: var(--primary);" data-translate="subjects">Subjects</h2>
                    <div class="card-container" id="subjectsCardContainer">
                        <!-- Cards will be dynamically loaded here -->
                    </div>
                </div>

                <!-- User Manager Section -->
                <div id="user-manager" class="page-section admin-only">
                    <div class="user-info-display" id="userManagerUserInfo">
                        <!-- User info will be dynamically loaded here -->
                    </div>
                    <div class="user-manager-header">
                        <div class="user-manager-title" data-translate="user_management">User Management</div>
                        <button class="add-user-btn" id="openModalBtn">
                            <i class="fas fa-plus"></i>
                            <span data-translate="add_new_user">Add New User</span>
                        </button>
                    </div>

                    <div class="user-table-container">
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th data-translate="id">ID</th>
                                    <th data-translate="name">Name</th>
                                    <th data-translate="username">Username</th>
                                    <th data-translate="password">Password</th>
                                    <th data-translate="email">Email</th>
                                    <th data-translate="role">Role</th>
                                    <th data-translate="actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- Users will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Questions Uploading Section -->
                <div id="questions-uploading" class="page-section admin-only">
                    <div class="user-info-display" id="questionsUploadingUserInfo">
                        <!-- User info will be dynamically loaded here -->
                    </div>
                    <!-- Upload Questions Section -->
                    <div class="question-upload-form">
                        <h2 class="section-title" data-translate="question_upload">Question Upload</h2>
                        <p class="section-subtitle" data-translate="upload_subtitle">Add questions to lessons and units</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="questionSubject" data-translate="subject">Subject</label>
                                <select class="form-select" id="questionSubject" required>
                                    <option value="">Select a subject</option>
                                    <option value="kurdish" data-translate="kurdish">Kurdish</option>
                                    <option value="english" data-translate="english">English</option>
                                    <option value="arabic" data-translate="arabic">Arabic</option>
                                    <option value="math" data-translate="math">Mathematics</option>
                                    <option value="science" data-translate="science">Science</option>
                                    <option value="social" data-translate="social">Social Studies</option>
                                    <option value="social-value" data-translate="social_value">Social Value</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="questionUnit">Unit</label>
                                <select class="form-select" id="questionUnit" required>
                                    <option value="">Select a unit</option>
                                    <!-- Units will be dynamically populated -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="questionLesson">Lesson</label>
                                <select class="form-select" id="questionLesson" required>
                                    <option value="">Select a lesson</option>
                                    <!-- Lessons will be dynamically populated -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="questionText" data-translate="question_text">Question Text</label>
                            <textarea class="form-textarea" id="questionText" placeholder="Enter the question" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-translate="options">Options</label>
                            <div class="option-row">
                                <input type="text" class="option-input" id="optionA" placeholder="Option A" required>
                                <div class="correct-option">
                                    <input type="radio" class="correct-checkbox" name="correctOption" value="0" required>
                                    <span>Correct</span>
                                </div>
                            </div>
                            <div class="option-row">
                                <input type="text" class="option-input" id="optionB" placeholder="Option B" required>
                                <div class="correct-option">
                                    <input type="radio" class="correct-checkbox" name="correctOption" value="1" required>
                                    <span>Correct</span>
                                </div>
                            </div>
                            <div class="option-row">
                                <input type="text" class="option-input" id="optionC" placeholder="Option C">
                                <div class="correct-option">
                                    <input type="radio" class="correct-checkbox" name="correctOption" value="2">
                                    <span>Correct</span>
                                </div>
                            </div>
                            <div class="option-row">
                                <input type="text" class="option-input" id="optionD" placeholder="Option D">
                                <div class="correct-option">
                                    <input type="radio" class="correct-checkbox" name="correctOption" value="3">
                                    <span>Correct</span>
                                </div>
                            </div>
                        </div>
                        
                        <button class="submit-btn" id="uploadQuestionBtn">
                            <i class="fas fa-upload"></i>
                            <span data-translate="upload_question">Upload Question</span>
                        </button>
                    </div>
                </div>

                <!-- Question Management Section -->
                <div id="question-management" class="page-section admin-only">
                    <div class="user-info-display" id="questionManagementUserInfo">
                        <!-- User info will be dynamically loaded here -->
                    </div>
                    <div class="question-manager-header">
                        <div class="question-manager-title" data-translate="question_management">Question Management</div>
                    </div>

                    <div class="question-filter">
                        <div class="filter-group">
                            <label class="form-label" for="filterSubject">Filter by Subject</label>
                            <select class="form-select" id="filterSubject">
                                <option value="">All Subjects</option>
                                <option value="kurdish">Kurdish</option>
                                <option value="english">English</option>
                                <option value="arabic">Arabic</option>
                                <option value="math">Mathematics</option>
                                <option value="science">Science</option>
                                <option value="social">Social Studies</option>
                                <option value="social-value">Social Value</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="form-label" for="filterUnit">Filter by Unit</label>
                            <select class="form-select" id="filterUnit">
                                <option value="">All Units</option>
                                <!-- Units will be dynamically populated -->
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="form-label" for="filterLesson">Filter by Lesson</label>
                            <select class="form-select" id="filterLesson">
                                <option value="">All Lessons</option>
                                <!-- Lessons will be dynamically populated -->
                            </select>
                        </div>
                    </div>

                    <div class="question-table-container">
                        <table class="question-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Subject</th>
                                    <th>Unit</th>
                                    <th>Lesson</th>
                                    <th>Question</th>
                                    <th>Options</th>
                                    <th>Correct Answer</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="questionTableBody">
                                <!-- Questions will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Unit and Lesson Management Section -->
                <div id="unit-lesson-management" class="page-section admin-only">
                    <div class="user-info-display" id="unitLessonManagementUserInfo">
                        <!-- User info will be dynamically loaded here -->
                    </div>
                    <!-- Unit and Lesson Management Section -->
                    <div class="content-section">
                        <h2 class="section-title" data-translate="unit_management">Unit and Lesson Management</h2>
                        <p class="section-subtitle" data-translate="unit_subtitle">Create and manage units and lessons</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="newUnitSubject" data-translate="subject">Subject</label>
                                <select class="form-select" id="newUnitSubject" required>
                                    <option value="">Select a subject</option>
                                    <option value="kurdish" data-translate="kurdish">Kurdish</option>
                                    <option value="english" data-translate="english">English</option>
                                    <option value="arabic" data-translate="arabic">Arabic</option>
                                    <option value="math" data-translate="math">Mathematics</option>
                                    <option value="science" data-translate="science">Science</option>
                                    <option value="social" data-translate="social">Social Studies</option>
                                    <option value="social-value" data-translate="social_value">Social Value</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="newUnitName">Unit Name</label>
                                <input type="text" class="form-input" id="newUnitName" placeholder="Enter unit name" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="newUnitDescription">Unit Description</label>
                                <input type="text" class="form-input" id="newUnitDescription" placeholder="Enter unit description">
                            </div>
                        </div>
                        
                        <button class="submit-btn" id="addUnitBtn">
                            <i class="fas fa-plus"></i>
                            <span data-translate="add_unit">Add Unit</span>
                        </button>
                        
                        <div class="form-row" style="margin-top: 20px;">
                            <div class="form-group">
                                <label class="form-label" for="newLessonUnit">Select Unit</label>
                                <select class="form-select" id="newLessonUnit" required>
                                    <option value="">Select a unit</option>
                                    <!-- Units will be dynamically populated -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="newLessonName">Lesson Name</label>
                                <input type="text" class="form-input" id="newLessonName" placeholder="Enter lesson name" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="newLessonDescription">Lesson Description</label>
                                <input type="text" class="form-input" id="newLessonDescription" placeholder="Enter lesson description">
                            </div>
                        </div>
                        
                        <button class="submit-btn" id="addLessonBtn">
                            <i class="fas fa-plus"></i>
                            <span data-translate="add_lesson">Add Lesson</span>
                        </button>
                    </div>

                    <!-- Unit and Lesson List Section -->
                    <div class="content-section">
                        <h2 class="section-title">Current Units and Lessons</h2>
                        <div class="unit-list" id="unitListContainer">
                            <!-- Units and lessons will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" data-translate="add_new_user">Add New User</div>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-group">
                        <label class="form-label" for="name" data-translate="full_name">Full Name</label>
                        <input type="text" class="form-input" id="name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="username" data-translate="username">Username</label>
                        <input type="text" class="form-input" id="username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="password" data-translate="password">Password</label>
                        <input type="password" class="form-input" id="password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="email" data-translate="email">Email</label>
                        <input type="email" class="form-input" id="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="role" data-translate="role">Role</label>
                        <select class="form-input" id="role" required>
                            <option value="">Select Role</option>
                            <option value="Admin" data-translate="admin">Admin</option>
                            <option value="Student" data-translate="student">Student</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" id="cancelBtn" data-translate="cancel">Cancel</button>
                <button class="save-btn" id="saveBtn" data-translate="save_user">Save User</button>
            </div>
        </div>
    </div>

    <!-- Edit Question Modal -->
    <div class="modal edit-question-modal" id="editQuestionModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Question</div>
                <button class="close-btn" id="closeEditQuestionModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editQuestionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="editQuestionSubject">Subject</label>
                            <select class="form-select" id="editQuestionSubject" required>
                                <option value="">Select a subject</option>
                                <option value="kurdish">Kurdish</option>
                                <option value="english">English</option>
                                <option value="arabic">Arabic</option>
                                <option value="math">Mathematics</option>
                                <option value="science">Science</option>
                                <option value="social">Social Studies</option>
                                <option value="social-value">Social Value</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="editQuestionUnit">Unit</label>
                            <select class="form-select" id="editQuestionUnit" required>
                                <option value="">Select a unit</option>
                                <!-- Units will be dynamically populated -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="editQuestionLesson">Lesson</label>
                            <select class="form-select" id="editQuestionLesson" required>
                                <option value="">Select a lesson</option>
                                <!-- Lessons will be dynamically populated -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editQuestionText">Question Text</label>
                        <textarea class="form-textarea" id="editQuestionText" placeholder="Enter the question" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Options</label>
                        <div class="option-row">
                            <input type="text" class="option-input" id="editOptionA" placeholder="Option A" required>
                            <div class="correct-option">
                                <input type="radio" class="correct-checkbox" name="editCorrectOption" value="0" required>
                                <span>Correct</span>
                            </div>
                        </div>
                        <div class="option-row">
                            <input type="text" class="option-input" id="editOptionB" placeholder="Option B" required>
                            <div class="correct-option">
                                <input type="radio" class="correct-checkbox" name="editCorrectOption" value="1" required>
                                <span>Correct</span>
                            </div>
                        </div>
                        <div class="option-row">
                            <input type="text" class="option-input" id="editOptionC" placeholder="Option C">
                            <div class="correct-option">
                                <input type="radio" class="correct-checkbox" name="editCorrectOption" value="2">
                                <span>Correct</span>
                            </div>
                        </div>
                        <div class="option-row">
                            <input type="text" class="option-input" id="editOptionD" placeholder="Option D">
                            <div class="correct-option">
                                <input type="radio" class="correct-checkbox" name="editCorrectOption" value="3">
                                <span>Correct</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" id="cancelEditQuestionBtn">Cancel</button>
                <button class="save-btn" id="saveEditQuestionBtn">Update Question</button>
            </div>
        </div>
    </div>

    <!-- Subject Detail Page -->
    <div class="subject-detail-page" id="subjectDetailPage" style="display: none;">
        <div class="header">
            <div class="header-left">
                <button class="mobile-menu-toggle" id="subjectDetailMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 id="subjectDetailTitle">Subject Detail</h1>
            </div>
            <div class="header-right">
                <div class="language-selector">
                    <button class="language-btn" id="subjectDetailLanguageBtn">
                        <i class="fas fa-globe"></i>
                        <span id="subjectDetailCurrentLanguage">English</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="language-dropdown" id="subjectDetailLanguageDropdown">
                        <div class="language-option active" data-lang="en">
                            <span>English</span>
                        </div>
                        <div class="language-option" data-lang="ku">
                            <span>Kurd</span>
                        </div>
                        <div class="language-option" data-lang="ar">
                            <span></span>
                        </div>
                    </div>
                </div>
                <div class="user-profile">
                    <div class="user-avatar" id="subjectDetailUserAvatar">AD</div>
                    <span id="subjectDetailCurrentUser">Admin User</span>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="user-info-display" id="subjectDetailUserInfo">
                <!-- User info will be dynamically loaded here -->
            </div>
            <button class="back-btn" id="backToDashboardFromSubject">
                <i class="fas fa-arrow-left"></i> <span data-translate="back_to_dashboard">Back to Dashboard</span>
            </button>
            <div class="detail-header">
                <div class="detail-title" id="subjectDetailPageTitle">Subject Name</div>
            </div>
            <div class="units-container" id="subjectDetailUnitsContainer">
                <!-- Units will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Quiz Taking Modal -->
    <div class="quiz-modal" id="quizModal">
        <div class="quiz-modal-content">
            <div class="quiz-modal-header">
                <div class="quiz-modal-title" id="quizModalTitle">Quiz Title</div>
                <div class="quiz-modal-subtitle" id="quizModalSubtitle">Subject  Questions</div>
            </div>
            <div class="quiz-modal-body">
                <div class="quiz-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">Question 1 of 5</div>
                </div>
                
                <div class="question-container-modal">
                    <div class="question-text-modal" id="currentQuestionText">Question text will appear here</div>
                    <div class="options-container" id="optionsContainer">
                        <!-- Options will be dynamically added here -->
                    </div>
                </div>
            </div>
            <div class="quiz-modal-footer">
                <button class="quiz-nav-btn prev-btn" id="prevQuestionBtn">
                    <i class="fas fa-arrow-left"></i> <span data-translate="previous">Previous</span>
                </button>
                <button class="quiz-nav-btn next-btn" id="nextQuestionBtn">
                    <span data-translate="next">Next</span> <i class="fas fa-arrow-right"></i>
                </button>
                <button class="quiz-nav-btn submit-btn" id="submitQuizBtn" style="display: none;">
                    <span data-translate="submit_quiz">Submit Quiz</span> <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="results-modal" id="resultsModal">
        <div class="results-content">
            <div class="results-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="results-title" data-translate="quiz_completed">Quiz Completed!</div>
            <div class="results-score" id="resultsScore">0/0</div>
            <div class="results-details" id="resultsDetails">
                <!-- Results will be dynamically added here -->
            </div>
            <button class="close-results-btn" id="closeResultsBtn" data-translate="close_results">
                Close Results
            </button>
        </div>
    </div>

    <script>
        // ========== LOCAL STORAGE API ==========
        const StorageAPI = {
            // Initialize default data if not exists
            init() {
                if (!localStorage.getItem('class9_users')) {
                    const defaultUsers = [
                        { id: 1, name: "Admin User", username: "admin", password: "admin123", email: "admin@school.edu", role: "Admin" },
                        { id: 2, name: "Student One", username: "student1", password: "student123", email: "student1@school.edu", role: "Student" },
                        { id: 3, name: "Student Two", username: "student2", password: "student123", email: "student2@school.edu", role: "Student" }
                    ];
                    this.setUsers(defaultUsers);
                }

                if (!localStorage.getItem('class9_questions')) {
                    const defaultQuestions = [
                        {
                            id: 1,
                            subject: "kurdish",
                            unitId: 1,
                            lessonId: 1,
                            question: "What is the capital of Kurdistan?",
                            options: ["Erbil", "Baghdad", "Damascus", "Tehran"],
                            correctAnswer: 0
                        },
                        {
                            id: 2,
                            subject: "kurdish",
                            unitId: 1,
                            lessonId: 1,
                            question: "Which language family does Kurdish belong to?",
                            options: ["Semitic", "Indo-European", "Turkic", "Dravidian"],
                            correctAnswer: 1
                        }
                    ];
                    this.setQuestions(defaultQuestions);
                }

                if (!localStorage.getItem('class9_units')) {
                    const defaultUnits = {
                        kurdish: [
                            { id: 1, name: "Grammar Basics", description: "Fundamental grammar rules", lessons: [
                                { id: 1, name: "Nouns and Pronouns", description: "Understanding nouns and pronouns" },
                                { id: 2, name: "Verb Conjugation", description: "How to conjugate verbs" }
                            ]},
                            { id: 2, name: "Literature", description: "Kurdish literary works", lessons: [
                                { id: 3, name: "Classic Poetry", description: "Study of classic Kurdish poetry" },
                                { id: 4, name: "Modern Prose", description: "Contemporary Kurdish literature" }
                            ]}
                        ],
                        english: [
                            { id: 1, name: "Basic Grammar", description: "English grammar fundamentals", lessons: [
                                { id: 1, name: "Tenses", description: "Understanding English tenses" },
                                { id: 2, name: "Sentence Structure", description: "Building proper sentences" }
                            ]},
                            { id: 2, name: "Vocabulary", description: "Expanding English vocabulary", lessons: [
                                { id: 3, name: "Common Phrases", description: "Everyday English expressions" },
                                { id: 4, name: "Academic Words", description: "Vocabulary for academic purposes" }
                            ]}
                        ]
                    };
                    this.setUnits(defaultUnits);
                }

                if (!localStorage.getItem('class9_language')) {
                    this.setLanguage('en');
                }
            },

            // User management
            getUsers() {
                return JSON.parse(localStorage.getItem('class9_users') || '[]');
            },

            setUsers(users) {
                localStorage.setItem('class9_users', JSON.stringify(users));
            },

            // Question management
            getQuestions() {
                return JSON.parse(localStorage.getItem('class9_questions') || '[]');
            },

            setQuestions(questions) {
                localStorage.setItem('class9_questions', JSON.stringify(questions));
            },

            // Unit and lesson management
            getUnits() {
                return JSON.parse(localStorage.getItem('class9_units') || '{}');
            },

            setUnits(units) {
                localStorage.setItem('class9_units', JSON.stringify(units));
            },

            // Language preference
            getLanguage() {
                return localStorage.getItem('class9_language') || 'en';
            },

            setLanguage(lang) {
                localStorage.setItem('class9_language', lang);
            },

            // Quiz results
            getQuizResults() {
                return JSON.parse(localStorage.getItem('class9_quiz_results') || '{}');
            },

            saveQuizResult(lessonId, score, totalQuestions) {
                const results = this.getQuizResults();
                const userId = currentUser ? currentUser.id : 'guest';
                
                if (!results[userId]) {
                    results[userId] = {};
                }
                
                if (!results[userId][lessonId]) {
                    results[userId][lessonId] = [];
                }
                
                results[userId][lessonId].push({
                    date: new Date().toISOString(),
                    score: score,
                    totalQuestions: totalQuestions
                });
                
                localStorage.setItem('class9_quiz_results', JSON.stringify(results));
            }
        };

        // ========== TOAST NOTIFICATION SYSTEM ==========
        function showToast(message, type = 'info', title = '') {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="fas ${icons[type] || icons.info} toast-icon"></i>
                <div class="toast-content">
                    ${title ? `<div class="toast-title">${title}</div>` : ''}
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ========== LOADING STATE FUNCTIONS ==========
        function setButtonLoading(button, loading) {
            if (loading) {
                button.classList.add('btn-loading');
                button.disabled = true;
            } else {
                button.classList.remove('btn-loading');
                button.disabled = false;
            }
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // ========== LANGUAGE SYSTEM ==========
        const translations = {
            en: {
                app_title: "CLASS 9", login_subtitle: "Learning Platform", username: "Username", password: "Password",
                login: "Login", login_error: "Invalid username or password!", dashboard: "Dashboard",
                admin_panel: "Learning Platform", user_manager: "User Manager", content_management: "Content Management",
                logout: "Logout", back_to_dashboard: "Back to Dashboard", user_management: "User Management",
                add_new_user: "Add New User", id: "ID", name: "Name", email: "Email", role: "Role",
                actions: "Actions", full_name: "Full Name", admin: "Admin", student: "Student",
                cancel: "Cancel", save_user: "Save User", question_upload: "Question Upload",
                upload_subtitle: "Add questions to lessons and units", title: "Title",
                description: "Description", subject: "Subject", upload_file: "Upload File",
                upload_text: "Click to upload or drag and drop", upload_hint: "PDF, DOC, PPT, Images (Max. 10MB)",
                upload_content: "Upload Content", unit_management: "Unit and Lesson Management",
                unit_subtitle: "Create and manage units and lessons", question_text: "Question Text",
                options: "Options", upload_question: "Upload Question", add_unit: "Add Unit",
                add_lesson: "Add Lesson", kurdish: "Kurdish", english: "English", arabic: "Arabic", 
                math: "Mathematics", science: "Science", social: "Social Studies", 
                social_value: "Social Value", subjects: "Subjects", previous: "Previous",
                next: "Next", submit_quiz: "Submit Quiz", quiz_completed: "Quiz Completed!",
                close_results: "Close Results", questions_uploading: "Questions Uploading",
                unit_lesson_management: "Unit and Lesson Management", question_management: "Question Management"
            },
            ku: {
                app_title: " ", login_subtitle: " ", username: " ",
                password: " ", login: "", login_error: "     !",
                dashboard: "", admin_panel: " ", user_manager: " ",
                content_management: " ", logout: "",
                back_to_dashboard: "  ", user_management: " ",
                add_new_user: "  ", id: "", name: "", email: "",
                role: "", actions: "", full_name: " ", admin: "",
                student: "", cancel: "", save_user: " ",
                question_upload: " ", upload_subtitle: "     ",
                title: "", description: "", subject: "", upload_file: " ",
                upload_text: "       ", 
                upload_hint: "PDF, DOC, PPT,  (:  )",
                upload_content: " ", unit_management: "   ",
                unit_subtitle: "     ", question_text: " ",
                options: "", upload_question: " ", add_unit: " ",
                add_lesson: " ", kurdish: "", english: "", arabic: "",
                math: "", science: "", social: " ",
                social_value: " ", subjects: "", previous: "",
                next: "", submit_quiz: " ", quiz_completed: "  !",
                close_results: " ", questions_uploading: " ",
                unit_lesson_management: "   ", question_management: " "
            },
            ar: {
                app_title: " ", login_subtitle: " ", username: " ",
                password: " ", login: " ", login_error: "      !",
                dashboard: " ", admin_panel: " ", user_manager: " ",
                content_management: " ", logout: " ",
                back_to_dashboard: "   ", user_management: " ",
                add_new_user: "  ", id: "", name: "", email: " ",
                role: "", actions: "", full_name: " ", admin: "",
                student: "", cancel: "", save_user: " ", question_upload: " ",
                upload_subtitle: "   ", title: "",
                description: "", subject: "", upload_file: " ",
                upload_text: "    ", upload_hint: "PDF, DOC, PPT,  (  10 )",
                upload_content: " ", unit_management: "  ",
                unit_subtitle: "   ", question_text: " ",
                options: "", upload_question: " ", add_unit: " ",
                add_lesson: " ", kurdish: "", english: "", arabic: "",
                math: "", science: "", social: " ",
                social_value: " ", subjects: "", previous: "",
                next: "", submit_quiz: " ", quiz_completed: "   !",
                close_results: " ", questions_uploading: " ",
                unit_lesson_management: "  ", question_management: " "
            }
        };

        let currentLanguage = 'en';

        function changeLanguage(lang) {
            currentLanguage = lang;
            StorageAPI.setLanguage(lang);
            
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update current language display
            document.getElementById('currentLanguage').textContent = 
                lang === 'en' ? 'English' : lang === 'ku' ? 'Kurd' : '';
            document.getElementById('subjectDetailCurrentLanguage').textContent = 
                lang === 'en' ? 'English' : lang === 'ku' ? 'Kurd' : '';
            
            // Update active language option
            document.querySelectorAll('.language-option').forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-lang') === lang) {
                    option.classList.add('active');
                }
            });
            
            showToast('Language changed successfully', 'success');
        }

        // ========== AUTHENTICATION SYSTEM ==========
        let users = [];
        let currentUser = null;

        function login(username, password) {
            showLoading();
            setTimeout(() => {
                const user = users.find(u => u.username === username && u.password === password);
                if (user) {
                    currentUser = user;
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('appContainer').classList.add('active');
                    document.getElementById('currentUser').textContent = user.name;
                    document.getElementById('userAvatar').textContent = user.name.split(' ').map(n => n[0]).join('');
                    document.getElementById('subjectDetailCurrentUser').textContent = user.name;
                    document.getElementById('subjectDetailUserAvatar').textContent = user.name.split(' ').map(n => n[0]).join('');
                    
                    // Show/hide admin features based on role
                    if (user.role === 'Admin') {
                        document.body.classList.add('user-admin');
                    } else {
                        document.body.classList.remove('user-admin');
                    }
                    
                    showToast(`Welcome back, ${user.name}!`, 'success');
                    loadDashboard();
                } else {
                    document.getElementById('loginError').style.display = 'block';
                    showToast('Invalid username or password', 'error');
                }
                hideLoading();
            }, 1000);
        }

        function logout() {
            currentUser = null;
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('loginForm').reset();
            document.body.classList.remove('user-admin');
            showToast('You have been logged out', 'info');
        }

        // ========== USER INFO DISPLAY ==========
        function updateUserInfoDisplay() {
            if (!currentUser) return;
            
            const userInfoElements = document.querySelectorAll('.user-info-display');
            userInfoElements.forEach(element => {
                element.innerHTML = `
                    <strong>Logged in as:</strong> ${currentUser.name} (${currentUser.role}) | 
                    <strong>Username:</strong> ${currentUser.username} | 
                    <strong>Email:</strong> ${currentUser.email}
                `;
            });
        }

        // ========== PAGE NAVIGATION ==========
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            switch(pageId) {
                case 'dashboard':
                    pageTitle.setAttribute('data-translate', 'dashboard');
                    pageTitle.textContent = translations[currentLanguage].dashboard;
                    break;
                case 'user-manager':
                    pageTitle.setAttribute('data-translate', 'user_management');
                    pageTitle.textContent = translations[currentLanguage].user_management;
                    break;
                case 'questions-uploading':
                    pageTitle.setAttribute('data-translate', 'questions_uploading');
                    pageTitle.textContent = translations[currentLanguage].questions_uploading;
                    break;
                case 'question-management':
                    pageTitle.setAttribute('data-translate', 'question_management');
                    pageTitle.textContent = translations[currentLanguage].question_management;
                    loadQuestions();
                    break;
                case 'unit-lesson-management':
                    pageTitle.setAttribute('data-translate', 'unit_lesson_management');
                    pageTitle.textContent = translations[currentLanguage].unit_lesson_management;
                    loadUnitList();
                    break;
            }
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === pageId) {
                    item.classList.add('active');
                }
            });
            
            // Update user info display
            updateUserInfoDisplay();
        }

        // ========== DASHBOARD AND SUBJECTS ==========
        const subjects = [
            { id: 1, name: "Kurdish", color: "#4CAF50", icon: "fa-language", key: "kurdish" },
            { id: 2, name: "English", color: "#2196F3", icon: "fa-language", key: "english" },
            { id: 3, name: "Arabic", color: "#FF9800", icon: "fa-language", key: "arabic" },
            { id: 4, name: "Mathematics", color: "#F44336", icon: "fa-calculator", key: "math" },
            { id: 5, name: "Science", color: "#9C27B0", icon: "fa-flask", key: "science" },
            { id: 6, name: "Social Studies", color: "#795548", icon: "fa-globe-americas", key: "social" },
            { id: 7, name: "Social Value", color: "#607D8B", icon: "fa-hands-helping", key: "social-value" }
        ];

        let units = {};

        function loadDashboard() {
            const container = document.getElementById('subjectsCardContainer');
            container.innerHTML = '';
            
            subjects.forEach(subject => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-icon" style="background-color: ${subject.color};">
                        <i class="fas ${subject.icon}"></i>
                    </div>
                    <h3>${subject.name}</h3>
                `;
                card.addEventListener('click', () => openSubject(subject));
                container.appendChild(card);
            });
            
            // Update user info display
            updateUserInfoDisplay();
        }

        function openSubject(subject) {
            // Hide main app and show subject detail page
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('subjectDetailPage').style.display = 'block';
            
            document.getElementById('subjectDetailPageTitle').textContent = subject.name;
            document.getElementById('subjectDetailTitle').textContent = subject.name;
            
            const container = document.getElementById('subjectDetailUnitsContainer');
            container.innerHTML = '';
            
            const subjectUnits = units[subject.key] || [];
            
            if (subjectUnits.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="empty-state-title">No Content Available</div>
                        <div class="empty-state-message">This subject doesn't have any units or lessons yet.</div>
                    </div>
                `;
                return;
            }
            
            subjectUnits.forEach(unit => {
                const unitElement = document.createElement('div');
                unitElement.className = 'unit-container';
                unitElement.innerHTML = `
                    <div class="unit-header">
                        <div class="unit-title">${unit.name}</div>
                        <div class="unit-toggle">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="lessons-container">
                        ${unit.lessons.map(lesson => `
                            <div class="lesson-item">
                                <div class="lesson-info">
                                    <div class="lesson-title">${lesson.name}</div>
                                    <div class="lesson-description">${lesson.description}</div>
                                </div>
                                <div class="lesson-actions">
                                    <button class="start-quiz-btn" data-lesson-id="${lesson.id}" data-subject="${subject.key}">
                                        <i class="fas fa-play"></i> Start Quiz
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                const unitHeader = unitElement.querySelector('.unit-header');
                const lessonsContainer = unitElement.querySelector('.lessons-container');
                const toggleIcon = unitElement.querySelector('.unit-toggle i');
                
                unitHeader.addEventListener('click', () => {
                    const isExpanded = lessonsContainer.style.display === 'block';
                    lessonsContainer.style.display = isExpanded ? 'none' : 'block';
                    toggleIcon.classList.toggle('expanded', !isExpanded);
                });
                
                container.appendChild(unitElement);
            });
            
            // Update user info display
            updateUserInfoDisplay();
        }

        // ========== USER MANAGEMENT ==========
        function loadUsers() {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.username}</td>
                    <td></td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td class="action-buttons">
                        <button class="edit-btn" data-user-id="${user.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="delete-btn" data-user-id="${user.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = parseInt(e.target.closest('button').getAttribute('data-user-id'));
                    editUser(userId);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = parseInt(e.target.closest('button').getAttribute('data-user-id'));
                    deleteUser(userId);
                });
            });
            
            // Update user info display
            updateUserInfoDisplay();
        }

        function addUser(userData) {
            const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
            const newUser = { id: newId, ...userData };
            users.push(newUser);
            StorageAPI.setUsers(users);
            loadUsers();
            showToast('User added successfully', 'success');
        }

        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                document.getElementById('name').value = user.name;
                document.getElementById('username').value = user.username;
                document.getElementById('password').value = user.password;
                document.getElementById('email').value = user.email;
                document.getElementById('role').value = user.role;
                
                document.getElementById('userModal').style.display = 'flex';
                document.querySelector('.modal-title').textContent = 'Edit User';
                document.getElementById('saveBtn').textContent = 'Update User';
                
                // Store the user ID for updating
                document.getElementById('saveBtn').setAttribute('data-edit-id', userId);
            }
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                const index = users.findIndex(u => u.id === userId);
                if (index !== -1) {
                    users.splice(index, 1);
                    StorageAPI.setUsers(users);
                    loadUsers();
                    showToast('User deleted successfully', 'success');
                }
            }
        }

        // ========== QUESTION MANAGEMENT ==========
        let questions = [];

        function loadQuestions() {
            const tbody = document.getElementById('questionTableBody');
            tbody.innerHTML = '';
            
            const subjectFilter = document.getElementById('filterSubject').value;
            const unitFilter = document.getElementById('filterUnit').value;
            const lessonFilter = document.getElementById('filterLesson').value;
            
            let filteredQuestions = questions;
            
            if (subjectFilter) {
                filteredQuestions = filteredQuestions.filter(q => q.subject === subjectFilter);
            }
            
            if (unitFilter) {
                filteredQuestions = filteredQuestions.filter(q => q.unitId === parseInt(unitFilter));
            }
            
            if (lessonFilter) {
                filteredQuestions = filteredQuestions.filter(q => q.lessonId === parseInt(lessonFilter));
            }
            
            if (filteredQuestions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-state-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div class="empty-state-title">No Questions Found</div>
                            <div class="empty-state-message">No questions match your current filters.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredQuestions.forEach(question => {
                const subject = subjects.find(s => s.key === question.subject);
                const unit = units[question.subject]?.find(u => u.id === question.unitId);
                const lesson = unit?.lessons?.find(l => l.id === question.lessonId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${question.id}</td>
                    <td>${subject ? subject.name : question.subject}</td>
                    <td>${unit ? unit.name : 'N/A'}</td>
                    <td>${lesson ? lesson.name : 'N/A'}</td>
                    <td>
                        <div class="question-text">${question.question}</div>
                    </td>
                    <td>
                        <div class="question-options">
                            ${question.options.map((option, index) => `
                                <div>${String.fromCharCode(65 + index)}. ${option}</div>
                            `).join('')}
                        </div>
                    </td>
                    <td>
                        <div class="correct-option">${String.fromCharCode(65 + question.correctAnswer)}. ${question.options[question.correctAnswer]}</div>
                    </td>
                    <td class="action-buttons">
                        <button class="edit-btn" data-question-id="${question.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="delete-btn" data-question-id="${question.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-btn[data-question-id]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const questionId = parseInt(e.target.closest('button').getAttribute('data-question-id'));
                    editQuestion(questionId);
                });
            });
            
            document.querySelectorAll('.delete-btn[data-question-id]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const questionId = parseInt(e.target.closest('button').getAttribute('data-question-id'));
                    deleteQuestion(questionId);
                });
            });
        }

        function editQuestion(questionId) {
            const question = questions.find(q => q.id === questionId);
            if (question) {
                // Populate the edit form with question data
                document.getElementById('editQuestionSubject').value = question.subject;
                updateEditUnitSelectors(question.subject);
                
                // Set a timeout to ensure the units are loaded before setting the unit value
                setTimeout(() => {
                    document.getElementById('editQuestionUnit').value = question.unitId;
                    updateEditLessonSelectors(question.subject, question.unitId);
                    
                    // Set another timeout to ensure lessons are loaded before setting the lesson value
                    setTimeout(() => {
                        document.getElementById('editQuestionLesson').value = question.lessonId;
                        document.getElementById('editQuestionText').value = question.question;
                        document.getElementById('editOptionA').value = question.options[0] || '';
                        document.getElementById('editOptionB').value = question.options[1] || '';
                        document.getElementById('editOptionC').value = question.options[2] || '';
                        document.getElementById('editOptionD').value = question.options[3] || '';
                        
                        // Set the correct answer radio button
                        document.querySelector(`input[name="editCorrectOption"][value="${question.correctAnswer}"]`).checked = true;
                        
                        // Show the modal
                        document.getElementById('editQuestionModal').style.display = 'flex';
                        
                        // Store the question ID for updating
                        document.getElementById('saveEditQuestionBtn').setAttribute('data-edit-id', questionId);
                    }, 100);
                }, 100);
            }
        }

        function updateQuestion(questionId, questionData) {
            const index = questions.findIndex(q => q.id === questionId);
            if (index !== -1) {
                questions[index] = { ...questions[index], ...questionData };
                StorageAPI.setQuestions(questions);
                loadQuestions();
                showToast('Question updated successfully', 'success');
            }
        }

        function deleteQuestion(questionId) {
            if (confirm('Are you sure you want to delete this question?')) {
                const index = questions.findIndex(q => q.id === questionId);
                if (index !== -1) {
                    questions.splice(index, 1);
                    StorageAPI.setQuestions(questions);
                    loadQuestions();
                    showToast('Question deleted successfully', 'success');
                }
            }
        }

        // ========== QUIZ SYSTEM ==========
        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];

        function startQuiz(lessonId, subject) {
            // Filter questions by both lesson ID and subject
            currentQuiz = questions.filter(q => q.lessonId === lessonId && q.subject === subject);
            if (currentQuiz.length === 0) {
                showToast('No questions available for this lesson', 'warning');
                return;
            }
            
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuiz.length).fill(null);
            
            document.getElementById('quizModalTitle').textContent = 'Lesson Quiz';
            document.getElementById('quizModalSubtitle').textContent = `${currentQuiz.length} Questions`;
            
            showQuestion();
            document.getElementById('quizModal').style.display = 'flex';
        }

        function showQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('currentQuestionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            const optionLetters = ['A', 'B', 'C', 'D'];
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = `option-item ${userAnswers[currentQuestionIndex] === index ? 'selected' : ''}`;
                optionElement.innerHTML = `
                    <div class="option-letter">${optionLetters[index]}</div>
                    <div class="option-text">${option}</div>
                `;
                optionElement.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionElement);
            });
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / currentQuiz.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Question ${currentQuestionIndex + 1} of ${currentQuiz.length}`;
            
            // Update navigation buttons
            document.getElementById('prevQuestionBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextQuestionBtn').style.display = currentQuestionIndex < currentQuiz.length - 1 ? 'flex' : 'none';
            document.getElementById('submitQuizBtn').style.display = currentQuestionIndex === currentQuiz.length - 1 ? 'flex' : 'none';
        }

        function selectOption(optionIndex) {
            userAnswers[currentQuestionIndex] = optionIndex;
            showQuestion();
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuiz.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function submitQuiz() {
            let correctCount = 0;
            const resultsDetails = document.getElementById('resultsDetails');
            resultsDetails.innerHTML = '';
            
            currentQuiz.forEach((question, index) => {
                const isCorrect = userAnswers[index] === question.correctAnswer;
                if (isCorrect) correctCount++;
                
                const resultItem = document.createElement('div');
                resultItem.className = `result-item ${isCorrect ? 'correct' : 'incorrect'}`;
                resultItem.innerHTML = `
                    <div class="question-result">${index + 1}. ${question.question}</div>
                    <div class="answer-result">
                        <div class="result-comparison">
                            <div class="user-answer ${isCorrect ? 'correct' : ''}">
                                <strong>Your answer:</strong> ${question.options[userAnswers[index]]}
                            </div>
                            ${!isCorrect ? `
                                <div class="correct-answer">
                                    <strong>Correct answer:</strong> ${question.options[question.correctAnswer]}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                resultsDetails.appendChild(resultItem);
            });
            
            // Save quiz result
            StorageAPI.saveQuizResult(currentQuiz[0].lessonId, correctCount, currentQuiz.length);
            
            document.getElementById('resultsScore').textContent = `${correctCount}/${currentQuiz.length}`;
            document.getElementById('quizModal').style.display = 'none';
            document.getElementById('resultsModal').style.display = 'flex';
        }

        // ========== UNIT AND LESSON MANAGEMENT ==========
        function addUnit(subject, name, description) {
            if (!units[subject]) {
                units[subject] = [];
            }
            
            const newId = units[subject].length > 0 ? Math.max(...units[subject].map(u => u.id)) + 1 : 1;
            units[subject].push({
                id: newId,
                name: name,
                description: description,
                lessons: []
            });
            
            StorageAPI.setUnits(units);
            showToast('Unit added successfully', 'success');
            updateUnitSelectors();
            loadUnitList();
        }

        function addLesson(unitId, subject, name, description) {
            const unit = units[subject].find(u => u.id === unitId);
            if (unit) {
                const newId = unit.lessons.length > 0 ? Math.max(...unit.lessons.map(l => l.id)) + 1 : 1;
                unit.lessons.push({
                    id: newId,
                    name: name,
                    description: description
                });
                
                StorageAPI.setUnits(units);
                showToast('Lesson added successfully', 'success');
                updateLessonSelectors(subject, unitId);
                loadUnitList();
            }
        }

        function deleteUnit(subject, unitId) {
            if (confirm('Are you sure you want to delete this unit? All lessons in this unit will also be deleted.')) {
                const subjectUnits = units[subject];
                if (subjectUnits) {
                    const unitIndex = subjectUnits.findIndex(u => u.id === unitId);
                    if (unitIndex !== -1) {
                        // Also delete all questions associated with this unit
                        questions = questions.filter(q => !(q.subject === subject && q.unitId === unitId));
                        StorageAPI.setQuestions(questions);
                        
                        subjectUnits.splice(unitIndex, 1);
                        StorageAPI.setUnits(units);
                        showToast('Unit deleted successfully', 'success');
                        updateUnitSelectors();
                        loadUnitList();
                    }
                }
            }
        }

        function deleteLesson(subject, unitId, lessonId) {
            if (confirm('Are you sure you want to delete this lesson? All questions in this lesson will also be deleted.')) {
                const unit = units[subject]?.find(u => u.id === unitId);
                if (unit) {
                    const lessonIndex = unit.lessons.findIndex(l => l.id === lessonId);
                    if (lessonIndex !== -1) {
                        // Also delete all questions associated with this lesson
                        questions = questions.filter(q => !(q.subject === subject && q.unitId === unitId && q.lessonId === lessonId));
                        StorageAPI.setQuestions(questions);
                        
                        unit.lessons.splice(lessonIndex, 1);
                        StorageAPI.setUnits(units);
                        showToast('Lesson deleted successfully', 'success');
                        updateLessonSelectors(subject, unitId);
                        loadUnitList();
                    }
                }
            }
        }

        function loadUnitList() {
            const container = document.getElementById('unitListContainer');
            container.innerHTML = '';
            
            if (Object.keys(units).length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="empty-state-title">No Units Created</div>
                        <div class="empty-state-message">Create your first unit to get started.</div>
                    </div>
                `;
                return;
            }
            
            Object.keys(units).forEach(subjectKey => {
                const subject = subjects.find(s => s.key === subjectKey);
                if (!subject) return;
                
                const subjectUnits = units[subjectKey];
                if (subjectUnits.length === 0) return;
                
                const subjectHeader = document.createElement('h3');
                subjectHeader.style.marginTop = '30px';
                subjectHeader.style.marginBottom = '15px';
                subjectHeader.style.color = 'var(--primary)';
                subjectHeader.style.fontSize = '1.5rem';
                subjectHeader.textContent = subject.name;
                container.appendChild(subjectHeader);
                
                subjectUnits.forEach(unit => {
                    const unitElement = document.createElement('div');
                    unitElement.className = 'unit-item';
                    unitElement.innerHTML = `
                        <div class="unit-item-header">
                            <div class="unit-item-title">${unit.name}</div>
                            <div class="action-buttons">
                                <button class="delete-btn delete-unit-btn" data-subject="${subjectKey}" data-unit-id="${unit.id}">
                                    <i class="fas fa-trash"></i> Delete Unit
                                </button>
                            </div>
                        </div>
                        <div class="unit-item-description">${unit.description || 'No description'}</div>
                        <div class="lesson-list">
                            ${unit.lessons.length > 0 ? 
                                unit.lessons.map(lesson => `
                                    <div class="lesson-item">
                                        <div class="lesson-info">
                                            <div class="lesson-item-title">${lesson.name}</div>
                                            <div class="lesson-item-description">${lesson.description || 'No description'}</div>
                                        </div>
                                        <div class="lesson-actions">
                                            <button class="delete-btn delete-lesson-btn" data-subject="${subjectKey}" data-unit-id="${unit.id}" data-lesson-id="${lesson.id}">
                                                <i class="fas fa-trash"></i> Delete Lesson
                                            </button>
                                        </div>
                                    </div>
                                `).join('') : 
                                '<div class="empty-state-message">No lessons in this unit</div>'
                            }
                        </div>
                    `;
                    container.appendChild(unitElement);
                });
            });
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-unit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const subject = e.target.closest('button').getAttribute('data-subject');
                    const unitId = parseInt(e.target.closest('button').getAttribute('data-unit-id'));
                    deleteUnit(subject, unitId);
                });
            });
            
            document.querySelectorAll('.delete-lesson-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const subject = e.target.closest('button').getAttribute('data-subject');
                    const unitId = parseInt(e.target.closest('button').getAttribute('data-unit-id'));
                    const lessonId = parseInt(e.target.closest('button').getAttribute('data-lesson-id'));
                    deleteLesson(subject, unitId, lessonId);
                });
            });
        }

        function updateUnitSelectors() {
            const unitSelectors = [
                document.getElementById('questionUnit'),
                document.getElementById('newLessonUnit'),
                document.getElementById('filterUnit')
            ];
            
            unitSelectors.forEach(selector => {
                if (selector) {
                    let currentSubject;
                    if (selector.id === 'questionUnit') {
                        currentSubject = document.getElementById('questionSubject').value;
                    } else if (selector.id === 'filterUnit') {
                        currentSubject = document.getElementById('filterSubject').value;
                    } else {
                        currentSubject = document.getElementById('newUnitSubject').value;
                    }
                    
                    const currentValue = selector.value;
                    
                    selector.innerHTML = '<option value="">Select a unit</option>';
                    
                    if (currentSubject && units[currentSubject]) {
                        units[currentSubject].forEach(unit => {
                            const option = document.createElement('option');
                            option.value = unit.id;
                            option.textContent = unit.name;
                            selector.appendChild(option);
                        });
                    }
                    
                    // Try to restore previous selection
                    if (currentValue) {
                        selector.value = currentValue;
                    }
                }
            });
        }

        function updateEditUnitSelectors(subject) {
            const selector = document.getElementById('editQuestionUnit');
            if (selector) {
                const currentValue = selector.value;
                
                selector.innerHTML = '<option value="">Select a unit</option>';
                
                if (subject && units[subject]) {
                    units[subject].forEach(unit => {
                        const option = document.createElement('option');
                        option.value = unit.id;
                        option.textContent = unit.name;
                        selector.appendChild(option);
                    });
                }
                
                // Try to restore previous selection
                if (currentValue) {
                    selector.value = currentValue;
                }
            }
        }

        function updateLessonSelectors(subject, unitId) {
            const lessonSelectors = [
                document.getElementById('questionLesson'),
                document.getElementById('filterLesson')
            ];
            
            lessonSelectors.forEach(lessonSelector => {
                if (lessonSelector) {
                    const currentValue = lessonSelector.value;
                    
                    lessonSelector.innerHTML = '<option value="">Select a lesson</option>';
                    
                    if (subject && unitId && units[subject]) {
                        const unit = units[subject].find(u => u.id === parseInt(unitId));
                        if (unit) {
                            unit.lessons.forEach(lesson => {
                                const option = document.createElement('option');
                                option.value = lesson.id;
                                option.textContent = lesson.name;
                                lessonSelector.appendChild(option);
                            });
                        }
                    }
                    
                    // Try to restore previous selection
                    if (currentValue) {
                        lessonSelector.value = currentValue;
                    }
                }
            });
        }

        function updateEditLessonSelectors(subject, unitId) {
            const lessonSelector = document.getElementById('editQuestionLesson');
            if (lessonSelector) {
                const currentValue = lessonSelector.value;
                
                lessonSelector.innerHTML = '<option value="">Select a lesson</option>';
                
                if (subject && unitId && units[subject]) {
                    const unit = units[subject].find(u => u.id === parseInt(unitId));
                    if (unit) {
                        unit.lessons.forEach(lesson => {
                            const option = document.createElement('option');
                            option.value = lesson.id;
                            option.textContent = lesson.name;
                            lessonSelector.appendChild(option);
                        });
                    }
                }
                
                // Try to restore previous selection
                if (currentValue) {
                    lessonSelector.value = currentValue;
                }
            }
        }

        // ========== EVENT LISTENERS ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize storage with default data
            StorageAPI.init();
            
            // Load data from storage
            users = StorageAPI.getUsers();
            questions = StorageAPI.getQuestions();
            units = StorageAPI.getUnits();
            currentLanguage = StorageAPI.getLanguage();
            
            // Apply language
            changeLanguage(currentLanguage);
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                login(username, password);
            });

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', logout);

            // Mobile menu toggle
            document.getElementById('mobileMenuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
            });

            // Language selector
            document.getElementById('languageBtn').addEventListener('click', function() {
                document.getElementById('languageDropdown').classList.toggle('active');
            });

            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    changeLanguage(lang);
                    document.getElementById('languageDropdown').classList.remove('active');
                });
            });

            // Menu navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    showPage(page);
                    
                    // Close mobile sidebar after selection
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });

            // Back to dashboard from subject detail
            document.getElementById('backToDashboardFromSubject').addEventListener('click', function() {
                document.getElementById('subjectDetailPage').style.display = 'none';
                document.getElementById('appContainer').style.display = 'flex';
            });

            // User management modal
            document.getElementById('openModalBtn').addEventListener('click', function() {
                document.getElementById('userModal').style.display = 'flex';
                document.getElementById('userForm').reset();
                document.querySelector('.modal-title').textContent = 'Add New User';
                document.getElementById('saveBtn').textContent = 'Save User';
                document.getElementById('saveBtn').removeAttribute('data-edit-id');
            });

            document.getElementById('closeModalBtn').addEventListener('click', function() {
                document.getElementById('userModal').style.display = 'none';
            });

            document.getElementById('cancelBtn').addEventListener('click', function() {
                document.getElementById('userModal').style.display = 'none';
            });

            document.getElementById('saveBtn').addEventListener('click', function() {
                const name = document.getElementById('name').value;
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const email = document.getElementById('email').value;
                const role = document.getElementById('role').value;
                
                const userData = { name, username, password, email, role };
                
                const editId = this.getAttribute('data-edit-id');
                if (editId) {
                    // Update existing user
                    const userIndex = users.findIndex(u => u.id === parseInt(editId));
                    if (userIndex !== -1) {
                        users[userIndex] = { ...users[userIndex], ...userData };
                        StorageAPI.setUsers(users);
                        loadUsers();
                        showToast('User updated successfully', 'success');
                    }
                } else {
                    // Add new user
                    addUser(userData);
                }
                
                document.getElementById('userModal').style.display = 'none';
            });

            // Quiz navigation
            document.getElementById('nextQuestionBtn').addEventListener('click', nextQuestion);
            document.getElementById('prevQuestionBtn').addEventListener('click', prevQuestion);
            document.getElementById('submitQuizBtn').addEventListener('click', submitQuiz);
            
            // Close results modal
            document.getElementById('closeResultsBtn').addEventListener('click', function() {
                document.getElementById('resultsModal').style.display = 'none';
            });

            // Content management
            document.getElementById('addUnitBtn').addEventListener('click', function() {
                const subject = document.getElementById('newUnitSubject').value;
                const name = document.getElementById('newUnitName').value;
                const description = document.getElementById('newUnitDescription').value;
                
                if (subject && name) {
                    addUnit(subject, name, description);
                    document.getElementById('newUnitName').value = '';
                    document.getElementById('newUnitDescription').value = '';
                } else {
                    showToast('Please fill in all required fields', 'error');
                }
            });

            document.getElementById('addLessonBtn').addEventListener('click', function() {
                const unitId = parseInt(document.getElementById('newLessonUnit').value);
                const subject = document.getElementById('newUnitSubject').value;
                const name = document.getElementById('newLessonName').value;
                const description = document.getElementById('newLessonDescription').value;
                
                if (unitId && subject && name) {
                    addLesson(unitId, subject, name, description);
                    document.getElementById('newLessonName').value = '';
                    document.getElementById('newLessonDescription').value = '';
                } else {
                    showToast('Please fill in all required fields', 'error');
                }
            });

            document.getElementById('uploadQuestionBtn').addEventListener('click', function() {
                const subject = document.getElementById('questionSubject').value;
                const unitId = parseInt(document.getElementById('questionUnit').value);
                const lessonId = parseInt(document.getElementById('questionLesson').value);
                const questionText = document.getElementById('questionText').value;
                const optionA = document.getElementById('optionA').value;
                const optionB = document.getElementById('optionB').value;
                const optionC = document.getElementById('optionC').value;
                const optionD = document.getElementById('optionD').value;
                const correctOption = document.querySelector('input[name="correctOption"]:checked');
                
                if (subject && unitId && lessonId && questionText && optionA && optionB && correctOption) {
                    const newQuestion = {
                        id: questions.length > 0 ? Math.max(...questions.map(q => q.id)) + 1 : 1,
                        subject: subject,
                        unitId: unitId,
                        lessonId: lessonId,
                        question: questionText,
                        options: [optionA, optionB, optionC || '', optionD || ''].filter(opt => opt !== ''),
                        correctAnswer: parseInt(correctOption.value)
                    };
                    
                    questions.push(newQuestion);
                    StorageAPI.setQuestions(questions);
                    
                    // Clear form
                    document.getElementById('questionText').value = '';
                    document.getElementById('optionA').value = '';
                    document.getElementById('optionB').value = '';
                    document.getElementById('optionC').value = '';
                    document.getElementById('optionD').value = '';
                    document.querySelectorAll('input[name="correctOption"]').forEach(radio => {
                        radio.checked = false;
                    });
                    
                    showToast('Question uploaded successfully', 'success');
                } else {
                    showToast('Please fill in all required fields', 'error');
                }
            });

            // Edit question modal
            document.getElementById('closeEditQuestionModalBtn').addEventListener('click', function() {
                document.getElementById('editQuestionModal').style.display = 'none';
            });

            document.getElementById('cancelEditQuestionBtn').addEventListener('click', function() {
                document.getElementById('editQuestionModal').style.display = 'none';
            });

            document.getElementById('saveEditQuestionBtn').addEventListener('click', function() {
                const questionId = parseInt(this.getAttribute('data-edit-id'));
                const subject = document.getElementById('editQuestionSubject').value;
                const unitId = parseInt(document.getElementById('editQuestionUnit').value);
                const lessonId = parseInt(document.getElementById('editQuestionLesson').value);
                const questionText = document.getElementById('editQuestionText').value;
                const optionA = document.getElementById('editOptionA').value;
                const optionB = document.getElementById('editOptionB').value;
                const optionC = document.getElementById('editOptionC').value;
                const optionD = document.getElementById('editOptionD').value;
                const correctOption = document.querySelector('input[name="editCorrectOption"]:checked');
                
                if (subject && unitId && lessonId && questionText && optionA && optionB && correctOption) {
                    const questionData = {
                        subject: subject,
                        unitId: unitId,
                        lessonId: lessonId,
                        question: questionText,
                        options: [optionA, optionB, optionC || '', optionD || ''].filter(opt => opt !== ''),
                        correctAnswer: parseInt(correctOption.value)
                    };
                    
                    updateQuestion(questionId, questionData);
                    document.getElementById('editQuestionModal').style.display = 'none';
                } else {
                    showToast('Please fill in all required fields', 'error');
                }
            });

            // Update unit selectors when subject changes
            document.getElementById('questionSubject').addEventListener('change', updateUnitSelectors);
            document.getElementById('newUnitSubject').addEventListener('change', updateUnitSelectors);
            document.getElementById('filterSubject').addEventListener('change', function() {
                updateUnitSelectors();
                loadQuestions();
            });
            
            // Update edit unit selectors when subject changes
            document.getElementById('editQuestionSubject').addEventListener('change', function() {
                const subject = this.value;
                updateEditUnitSelectors(subject);
            });
            
            // Update lesson selector when unit changes
            document.getElementById('questionUnit').addEventListener('change', function() {
                const subject = document.getElementById('questionSubject').value;
                const unitId = this.value;
                updateLessonSelectors(subject, unitId);
            });

            document.getElementById('filterUnit').addEventListener('change', function() {
                const subject = document.getElementById('filterSubject').value;
                const unitId = this.value;
                updateLessonSelectors(subject, unitId);
                loadQuestions();
            });

            document.getElementById('editQuestionUnit').addEventListener('change', function() {
                const subject = document.getElementById('editQuestionSubject').value;
                const unitId = this.value;
                updateEditLessonSelectors(subject, unitId);
            });

            document.getElementById('filterLesson').addEventListener('change', function() {
                loadQuestions();
            });

            // Initialize the application
            loadUsers();
            updateUnitSelectors();
            loadUnitList();
            
            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // Start quiz buttons (delegated event listener)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('start-quiz-btn') || e.target.closest('.start-quiz-btn')) {
                    const button = e.target.classList.contains('start-quiz-btn') ? e.target : e.target.closest('.start-quiz-btn');
                    const lessonId = parseInt(button.getAttribute('data-lesson-id'));
                    const subject = button.getAttribute('data-subject');
                    startQuiz(lessonId, subject);
                }
            });
        });
    </script>
</body>
</html>